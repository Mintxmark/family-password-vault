const { DefaultAzureCredential } = require('@azure/identity');
const { KeyVaultManagementClient } = require('@azure/arm-keyvault');

module.exports = async function (context, req) {
    const credential = new DefaultAzureCredential();
    const subscriptionId = process.env["AZURE_SUBSCRIPTION_ID"];
    const client = new KeyVaultManagementClient(credential, subscriptionId);

    try {
        const vaults = await client.vaults.list();
        const vaultNames = vaults.map(vault => ({
            name: vault.name,
            location: vault.location
        }));

        context.res = {
            status: 200,
            body: vaultNames
        };
    } catch (error) {
        context.res = {
            status: 500,
            body: `Error fetching vaults: ${error.message}`
        };
    }
};
